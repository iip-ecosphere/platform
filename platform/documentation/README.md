# IIP-Ecosphere platform documentation

## Further documents 
* Platform handbook via [Zenodo](https://doi.org/10.5281/zenodo.5168946) and the [IIP-Ecosphere Website](https://www.iip-ecosphere.eu/). The links may become active/updated some days after a release.
* [Catalogue of formats employed by the platform](../documentation/FORMATS.md).
* [Listing of typical procedures](../documentation/ACTIONS.md).
* [Guideline to open the code projects and setup the environment](../documentation/Guideline.pdf?raw=true).
* [Release guideline](../documentation/RELEASE.md)
* [Install information](../documentation/INSTALL.md) for own installation, Docker containers and for playing with pre-packaged containers.
* [Guideline for platform installation under Windows](../documentation/Platform_Installation_Guide_for_Windows.pdf)
* [Guideline for platform installation under Linux](../documentation/Platform_Installation_Guide_for_Linux.pdf)

## Guidelines
* There is an overall **architecture** and a **platform handbook** in the IIP-Ecosphere ownCloud. Please consult the architecture first to understand how existing and new parts are related.
* Please note that special characters like whitespaces in folder names (in particular on Windows) may cause the installation, platform installation or examples to fail.  
* **Java projects** are created with Eclipse (2020-12-R). Use iipCodeFormatter.xml from ``platformDependencies`` as formatter. Set text editor print margin to 120 characters. 
* For now, we use **JDK 8** in order to be compliant with Edge devices. In particular, for the lower layers that shall be used on edge devices, code must be executable on JDK 8. For higher layers, this limitation may be relaxed. To achieve exchangeable projects across development installations, use in Eclipse the execution environment ``JavaSE-1.8`` as JRE system library. This may be relaxed in future. To be on the safe side, install a recent (open) JDK 1.8 and associated it in Eclipse to JavaSE-1.8 so that only the JDK 1.8 library is available, i.e., no newer operations. 
* Use **Javadoc** to describe the parts and pieces as well as their contract and intention. We assume that parameters of reference types are passed in with instances unless the documentation indicates that null (in Javadoc in bold font) can be used.
* A related Java **Checkstyle** definition is based on Checkstyle 8.35 (definitions are working also up to 8.41.0). Please use a [compatible version](https://stackoverflow.com/questions/68208024/how-to-downgrade-checkstyle-to-8-40-or-8-41-in-eclipse) of checkstyle! The style definition is in ``platformDependencies`` and shall be added as a project local definition named ``IIP Code Conventions``to Checkstyle before importing the other projects (see [setup guideline](../documentation/Guideline.pdf?raw=true) for details). Please use empty lines as paragraph breaks in text, i.e., whenever a unit of code has been completed that is not an own method. An empty line after each line of code is not recommended in this project. However, empty lines in this sense are not part of the Checkstyle rules.
* Please install **FindBugs** or **Spotbugs** to avoid obvious programming problems.
* The **Java package prefix** shall be ``de.iip-ecosphere.platform``. Test packages shall start with ``test.de.iip-ecosphere.platform`` 
* Java files shall contain the **license header**. Existing files can be used as a template.
* Building Java parts happens with **Maven** (based on a parent POM, tested with 3.6.3 and 3.8.5). Groups are or start with ``de.iip-ecosphere.platform`` to comply with Maven central deployment. Use basic information from the parent POM as far as possible, e.g., valid URL, description, licenses, developers and SCM section. Redefine parts only if 
  needed except for dependencies - please define explicitly your minimum set of required dependencies (easing later deployment) Use existing test artifacts for reuse and, where possible, build your tests on existing functionality. In some cases, Eclipse shows errors on the parent POM, which cannot be validated with a standalone command line Maven installation. In theses cases, often, a refresh of the Maven information in Eclipse (project context menu, Maven sub-menu), a restart of Eclipse to refresh internal Maven caches or even the execution of a command line Maven on the respective project and a restart of Eclipse may resolve the issue.
* Specific functional components (with pre-scribed versions in the overall platform dependencies)
  * For *logging*, we use SLF4J. Typically, lower level dependency such as Spring or BaSyx ship with a respective logging setup, e.g., logback. Thus, individual IIP-Ecosphere projects may only specify a SLF4J implementation dependency for the testing scope but not for the production code.
  * For JSON encoding/decoding in the platform code we use jackson (core, preferred data-bind). However, for data processing along service chains, different (faster) libraries may be used. These dependencies are then introduced by the code generation.
* For new components, please write a **brief documentation** in terms of a ``README.md`` and hook that component appropriately into the parent documentations.
* For **tests with network**, e.g., communication protocols or AAS servers, please do not rely always on the same ports as subsequent tests may unexpectedly fail. Check the other tests for their port numbers or, better, use free ephemeral ports (see basic support component, ``NetUtils``) instead. Spring-based tests may require a specific initializer to override static configuration settings with dynamic information such as an ephemeral port. See tests in ``transport.spring.*`` for an example.
* **CI and SNAPSHOT deployment** currently are done via SSE-CI/SSE-Maven-Repo. For legacy reasons on the CI server Jenkins, we add a ``build-jk.xml`` ANT file that executes Maven and deploys the artifacts.
* **Docker deployment**: Currently, basic installation/demonstration containers are built and deployed automatically using a github script. The script can be triggered manually and will be triggered automatically when a new version of the platform is created. Two Docker containers (one including the platform servers and a setup for a resource on the same machine and one for the CLI) are built and deployed automatically with suffix ".latest" to DockerHub. Docker containers of (intermediate) "milestone" builds shall be achieved on DockerHub with the respective date (see [readme](https://github.com/iip-ecosphere/platform/blob/main/platform/tools/Install/container/readme.txt) in the install package).

## Issues

* Due to the **restriction to JDK 8**, libraries that are compiled for newer Java versions may not be executed. We try to avoid such libraries, in particular in production code. However, in test code, we cannot always avoid such libraries, e.g., if there is no alternative functionality (so far, we are not aware of a MQTT v5 broker for JDK 1.8). In such cases, *execution on a more recent JDK may be adequate* (you can control this by selecting the JDK, e.g., in the respective Eclipse execution environment). This does not taint broker installations, e.g., on edge devices, as there any (even binary, e.g., C based) version that provides the required protocol may be used. Please *check the documentation/README.md* whether the problem is already known, and if not, please inform the platform team about the problem. [spotted/contributed by Miguel Gomez Casado]
