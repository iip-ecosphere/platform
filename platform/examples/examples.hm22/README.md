# IIP-Ecosphere platform examples: HM'22/TddT'22

Source code for the IIP-Ecosphere "Hannover Messe 2022" (HM'22) demonstrator and the extended version to be shown at the exhibition of the "Tage der digitalen Technologien", Berlin (TddT'22).

For all Maven executions, please ensure that the Maven platformDependencies are installed (see [install](https://github.com/iip-ecosphere/platform/tree/main/platform/tools/Install)). Maven commands may run into trouble under Powershell. Use a JDK 8 - 13, generation does not run, e.g., on JDK 17. Instantiation process:

- `mvn -P EasyGen generate-sources` downloads and unpacks the actual sources of the configuration model/the instantiation process. Use `-P` to obtain the most recent snapshot. If already build, a short build as described below shall be sufficient.
- `mvn -P EasyGen exec:java@generateAppsNoDeps` validates the model, generates the application-specific service interfaces (Java, Python), the transport mechanisms and most of the data processing service integration but without dependencies to implementation code (`NoDeps`). This must be done on a fresh checkout as interface artifacts are not deployed via Maven Central/Snapshots.
- `mvn -P App install -DskipTests` compiles the actual application code based on the interfaces generated by `NoDeps`. Installs the application code into the local Maven repository for integration to a full app in the next step. `-DskipTests` may be needed if the Maven test plugin does not work correctly for you as it is the case for many Windows installations we know about.
- `mvn -P EasyGen exec:java@generateApps` does roughly the same as `generateAppsNoDeps` but now utilizes all known service artifact dependencies, in particular those to code compiled and deployed in the previous step. Compiles and packages the full application.

The project contains an identity store (`src/main/resources/identityStore.yml`) declaring all username/password combinations as identity tokes. This includes now the authentication token for the broker. For packaging reasons, the same file must also be located in (`resources/software`). The build process overwrites that file by `src/main/resources/identityStore.yml`, so please make changes only in `src/main/resources/identityStore.yml`. 

Due to licensing issues, the project contains the IIP-Ecosphere fake version of RTSA. Currently, the project does not include the Python AI code.

## Command line switches

This app has several command line switches (`mock` indicate mocking/testing parts). You can apply them togeher with `mvn -P App exec:java...` by adding e.g., `-Diip.app.hm22.mock.doEvents=false`.
- `iip.app.hm22.mock.doEvents` (default: `true`) pass the events through to the App AAS
- `iip.app.hm22.mock.logAll` (default: `false`)  log all incoming events/traces. That might be a bit much, just for debugging, in particular the connectors.
- `iip.app.hm22.mock.cmdPeriod` (default: `60000`) period between sending automated/mocked commands
- `iip.app.hm22.usePlc` (default: `false`) use the PLC or the PC Python commands to control the robot
- `iip.app.hm22.env` (default: `HM22`) string to be passed on to the Python robot commands to select the waypoint set
- `iip.app.hm22.camSource.timer` (default: `false`) use a timer integrated into the Cam source to create regular images for testing, one image all 40s
- `iip.app.hm22.mock.callRobot` (default: `false`) allow to call the robot/PLC

## Tests (in development)

Most tests are generated, not all are yet hooked in here. Connector tests work, service tests may not work until platform version 0.5.0.

- OPC UA input: `mvn -P App exec:java@plc-opc`
- MDZH server `mvn -P App exec:java@mdzh-server``
- Action decider: `mvn -P App exec:java@action-decider`
- Full application standalone: `mvn -P App exec:java@app -Diip.app.hm22.mock.callRobot=false` does a single run-through with simulated OPC data. Requires MDZH server and broker to be started separately.

## Desirable

- Explaining slides, may be a video.
- Generated service tests